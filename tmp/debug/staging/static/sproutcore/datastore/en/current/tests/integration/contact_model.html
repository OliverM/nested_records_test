<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    
    <script>
    var SC_benchmarkPreloadEvents = { headStart: new Date().getTime() };
    </script>
    
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Script-Type" content="text/javascript" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="viewport" content="initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    
    <link rel="apple-touch-icon" href="" />
    <link rel="apple-touch-startup-image" media="screen and (orientation:portrait)" href="" /> 
    <link rel="apple-touch-startup-image" media="screen and (orientation:landscape)" href="" />
    <link rel="shortcut icon" href="" type="image/x-icon" />
    
    <title>Sproutcore Datastore</title>
  <script type="text/javascript">String.preferredLanguage = "en";</script>
<script type="text/javascript">
/* >>>>>>>>>> BEGIN source/core.js */
// ==========================================================================
// Project:   SproutCore - JavaScript Application Framework
// Copyright: ©2006-2011 Strobe Inc. and contributors.
//            Portions ©2008-2011 Apple Inc. All rights reserved.
// License:   Licensed under MIT license (see license.js)
// ==========================================================================


/* >>>>>>>>>> BEGIN source/system/browser.js */
// ==========================================================================
// Project:   SproutCore - JavaScript Application Framework
// Copyright: ©2006-2011 Strobe Inc. and contributors.
//            Portions ©2008-2011 Apple Inc. All rights reserved.
// License:   Licensed under MIT license (see license.js)
// ==========================================================================

window.SC = window.SC || { MODULE_INFO: {}, LAZY_INSTANTIATION: {} };

SC._detectBrowser = function(userAgent, language) {
  var version, webkitVersion, browser = {};

  userAgent = (userAgent || navigator.userAgent).toLowerCase();
  language = language || navigator.language || navigator.browserLanguage;

  // Gibberish at the end is to determine when the browser version is done
  version = browser.version = (userAgent.match( /.*(?:rv|chrome|webkit|opera|ie)[\/: ](.+?)([ \);]|$)/ ) || [])[1];
  webkitVersion = (userAgent.match( /webkit\/(.+?) / ) || [])[1];

  /**
    @name SC.browser.isWindows
    @type Boolean
  */
  browser.windows = browser.isWindows = !!/windows/.test(userAgent);
  
  /**
    @name SC.browser.isMac
    @type Boolean
  */
  browser.mac = browser.isMac = !!/macintosh/.test(userAgent) || (/mac os x/.test(userAgent) && !/like mac os x/.test(userAgent));
  
  /**
    @name SC.browser.isiPhone
    @type Boolean
  */
  browser.iPhone = browser.isiPhone = !!/iphone/.test(userAgent);
  
  /**
    @name SC.browser.isiPod
    @type Boolean
  */
  browser.iPod = browser.isiPod = !!/ipod/.test(userAgent);
  
  /**
    @name SC.browser.isiPad
    @type Boolean
  */
  browser.iPad = browser.isiPad = !!/ipad/.test(userAgent);
  
  /**
    @name SC.browser.isiOS
    @type Boolean
  */
  browser.iOS = browser.isiOS = browser.iPhone || browser.iPod || browser.iPad;
  
  /**
    @name SC.browser.isAndroid
    @type Boolean
  */
  browser.android = browser.isAndroid = !!/android/.test(userAgent);

  /**
    @name SC.browser.opera
    @type String
  */
  browser.opera = /opera/.test(userAgent) ? version : 0;
  
  /**
    @name SC.browser.isOpera
    @type Boolean
  */
  browser.isOpera = !!browser.opera;

  /**
    @name SC.browser.msie
    @type String
  */
  browser.msie = /msie/.test(userAgent) && !browser.opera ? version : 0;
  
  /**
    @name SC.browser.isIE
    @type Boolean
  */
  browser.isIE = !!browser.msie;
  
  /**
    @name SC.browser.isIE8OrLower
    @type Boolean
  */
  browser.isIE8OrLower = !!(browser.msie && parseInt(browser.msie, 10) <= 8);

  /**
    @name SC.browser.mozilla
    @type String
  */
  browser.mozilla = /mozilla/.test(userAgent) && !/(compatible|webkit|msie)/.test(userAgent) ? version : 0;
  
  /**
    @name SC.browser.isMozilla
    @type Boolean
  */
  browser.isMozilla = !!browser.mozilla;

  /**
    @name SC.browser.webkit
    @type String
  */
  browser.webkit = /webkit/.test(userAgent) ? webkitVersion : 0;
  
  /**
    @name SC.browser.isWebkit
    @type Boolean
  */
  browser.isWebkit = !!browser.webkit;

  /**
    @name SC.browser.chrome
    @type String
  */
  browser.chrome = /chrome/.test(userAgent) ? version: 0;
  
  /**
    @name SC.browser.isChrome
    @type Boolean
  */
  browser.isChrome = !!browser.chrome;

  /**
    @name SC.browser.mobileSafari
    @type String
  */
  browser.mobileSafari = /apple.*mobile.*safari/.test(userAgent) && browser.iOS ? webkitVersion : 0;
  
  /**
    @name SC.browser.isMobileSafari
    @type Boolean
  */
  browser.isMobileSafari = !!browser.mobileSafari;

  /**
    @name SC.browser.iPadSafari
    @type String
  */
  browser.iPadSafari = browser.iPad && browser.isMobileSafari ? webkitVersion : 0;
  
  /**
    @name SC.browser.isiPadSafari
    @type Boolean
  */
  browser.isiPadSafari = !!browser.iPadSafari;

  /**
    @name SC.browser.iPhoneSafari
    @type String
  */
  browser.iPhoneSafari = browser.iPhone && browser.isMobileSafari ? webkitVersion : 0;
  
  /**
    @name SC.browser.isiPhoneSafari
    @type Boolean
  */
  browser.isiPhoneSafari = !!browser.iphoneSafari;

  /**
    @name SC.browser.iPodSafari
    @type String
  */
  browser.iPodSafari = browser.iPod && browser.isMobileSafari ? webkitVersion : 0;
  
  /**
    @name SC.browser.isiPodSafari
    @type Boolean
  */
  browser.isiPodSafari = !!browser.iPodSafari;

  /**
    @name SC.browser.safari
    @type String
  */
  browser.safari = browser.webkit && !browser.chrome && !browser.iOS && !browser.android ? webkitVersion : 0;
  
  /**
    @name SC.browser.isSafari
    @type Boolean
  */
  browser.isSafari = !!browser.safari;

  /**
    @name SC.browser.language
    @type String
  */
  browser.language = language.split('-', 1)[0];
  
  /**
    Possible values:
    
      - 'msie'
      - 'mozilla'
      - 'chrome'
      - 'safari'
      - 'opera'
      - 'mobile-safari'
      - 'unknown'

    @name SC.browser.current
    @type String
    @default 'unknown'
  */
  browser.current = browser.msie ? 'msie' : browser.mozilla ? 'mozilla' : browser.chrome ? 'chrome' : browser.safari ? 'safari' : browser.opera ? 'opera' : browser.mobileSafari ? 'mobile-safari' : browser.android ? 'android' : 'unknown';
  return browser;
};


/** @class
  
  Contains information about the browser environment that SproutCore
  is running in. String properties, such as `SC.browser.webkit` or
  `SC.browser.msie`, will have a value that represents the browser build
  number if that browser is being used. Otherwise, they will have a
  falsey value. For convenience, Boolean counterparts for all of the
  versioned properties are provided.
  
  @since SproutCore 1.0
*/
SC.browser = SC._detectBrowser();

/* >>>>>>>>>> BEGIN source/system/bench.js */
// ==========================================================================
// Project:   SproutCore - JavaScript Application Framework
// Copyright: ©2006-2011 Strobe Inc. and contributors.
//            Portions ©2008-2011 Apple Inc. All rights reserved.
// License:   Licensed under MIT license (see license.js)
// ==========================================================================
/*global SC_benchmarkPreloadEvents*/
// sc_require("system/browser")
if (typeof SC_benchmarkPreloadEvents !== "undefined") {
  SC.benchmarkPreloadEvents = SC_benchmarkPreloadEvents;
  SC_benchmarkPreloadEvents = undefined;
} else {
  SC.benchmarkPreloadEvents = { headStart: new Date().getTime() };
}
/* >>>>>>>>>> BEGIN source/system/loader.js */
// ==========================================================================
// Project:   SproutCore - JavaScript Application Framework
// Copyright: ©2006-2011 Strobe Inc. and contributors.
//            Portions ©2008-2011 Apple Inc. All rights reserved.
// License:   Licensed under MIT license (see license.js)
// ==========================================================================

// sc_require("system/browser");

SC.setupBodyClassNames = function() {
  var el = document.body ;
  if (!el) return ;
  var browser, platform, shadows, borderRad, classNames, style;
  browser = SC.browser.current ;
  platform = SC.browser.windows ? 'windows' : SC.browser.mac ? 'mac' : 'other-platform' ;
  style = document.documentElement.style;
  shadows = (style.MozBoxShadow !== undefined) || 
                (style.webkitBoxShadow !== undefined) ||
                (style.oBoxShadow !== undefined) ||
                (style.boxShadow !== undefined);
  
  borderRad = (style.MozBorderRadius !== undefined) || 
              (style.webkitBorderRadius !== undefined) ||
              (style.oBorderRadius !== undefined) ||
              (style.borderRadius !== undefined);
  
  classNames = el.className ? el.className.split(' ') : [] ;
  if(shadows) classNames.push('box-shadow');
  if(borderRad) classNames.push('border-rad');
  classNames.push(browser) ;
  if (browser === 'chrome') classNames.push('safari');
  classNames.push(platform) ;
  
  var ieVersion = parseInt(SC.browser.msie,10);
  if (ieVersion) {
    if (ieVersion === 7) {
      classNames.push('ie7');
    } 
    else if (ieVersion === 8) {
      classNames.push('ie8');
    }
    else if (ieVersion === 9) {
      classNames.push('ie9');
    }
  }
  
  if (SC.browser.mobileSafari) classNames.push('mobile-safari') ;
  if ('createTouch' in document) classNames.push('touch');
  el.className = classNames.join(' ') ;
} ;


</script>
<script type="text/javascript">SC.buildMode = "debug"; 
 SC.urlPrefix = ""; </script>


    <script>
      (function() { 
        var styles = [];
        if (window.devicePixelRatio == 2 || window.location.search.indexOf("2x") > -1) {
          styles = ["/static/sproutcore/testing/en/current/stylesheet.css?1307720226"];
        } else {
          styles = ["/static/sproutcore/testing/en/current/stylesheet.css?1307720226"];
        }

        var head = document.getElementsByTagName("head")[0];
        var len = styles.length, idx;
        for (idx = 0; idx < len; idx++) {
          var css   = document.createElement('link');
          css.rel   = 'stylesheet';
          css.type  = 'text/css';
          css.href  = styles[idx];
          css.media = 'screen'
          head.appendChild(css);
        }
      })();
    </script>

    
    <script>
      SC.benchmarkPreloadEvents['headEnd'] = new Date().getTime();
    </script>
  </head>
    
  <body class="sc-theme focus">  
    <script>
    SC.benchmarkPreloadEvents['bodyStart'] = new Date().getTime();
    </script>
<script type="text/javascript">
// ==========================================================================
// Project:   SproutCore - JavaScript Application Framework
// Copyright: ©2006-2011 Strobe Inc. and contributors.
//            Portions ©2008-2011 Apple Inc. All rights reserved.
// License:   Licensed under MIT license (see license.js)
// ==========================================================================

// sc_resource('setup_body_class_names'); // publish into inline format

if (SC.setupBodyClassNames) SC.setupBodyClassNames() ;

</script>


  <script type="text/javascript" src="/static/sproutcore/jquery/en/current/javascript.js?1307720226"></script>
  <script type="text/javascript" src="/static/sproutcore/debug/en/current/javascript.js?1307720226"></script>
  <script type="text/javascript" src="/static/sproutcore/testing/en/current/javascript.js?1307720226"></script>
  <script type="text/javascript" src="/static/sproutcore/runtime/en/current/javascript.js?1307720226"></script>
  <script type="text/javascript" src="/static/sproutcore/datetime/core/en/current/javascript.js?1307720226"></script>
  <script type="text/javascript" src="/static/sproutcore/datastore/en/current/javascript.js?1307720225"></script>
<script type="text/javascript">
if (typeof SC !== "undefined") {
  SC.mode = "TEST_MODE";
  SC.filename = "static/sproutcore/datastore/en/current/tests/integration/contact_model.js"; 
}
(function() {
// ==========================================================================
// Project:   SproutCore - JavaScript Application Framework
// Copyright: ©2006-2011 Strobe Inc. and contributors.
//            Portions ©2008-2011 Apple Inc. All rights reserved.
// License:   Licensed under MIT license (see license.js)
// ==========================================================================
/*globals module test ok equals same AB */

var AB;
module("Sample Model from an address book app", { 
  setup: function() {

    // define the application space
    AB = SC.Application.create({
      store: SC.Store.create(SC.Record.fixtures)
    });

    // Describes a single contact detail such as a phone number, address,
    // email, etc.
    AB.ContactDetail = SC.Record.extend({
      
    });
    
    // Describes a generic contact.  A contact has contact details, which 
    // describe contact info.  A contact also has a fullName, which changes
    // depending on the type.
    AB.Contact = SC.Record.extend({

      details: SC.Record.toMany(AB.ContactDetail)
      
    });
    
    AB.ContactGroup = SC.Record.extend({
      
      // creates a computed property that will fetch with a keyname 'contacts'
      // and params 'group': this.  Collection will be setup with newRecord
      // to create contact records.
      contacts: SC.Collection.fetch({
        inverse: 'group',
        recordType: 'AB.Contact'
      })
      
    });
    
    // a generic contact detail must always have a label, kind, and value
    AB.ContactDetail = SC.Record.extend({
      validateLabel: SC.Record.validate(String).required(),
      validateKind:  SC.Record.validate(String).required()
    });

    AB.PhoneNumber   = AB.ContactDetail.extend({
      kindDefault:  'phone',
      labelDefault: 'home'
    });
    
    AB.Contact = SC.Record.extend({

      // firstName, lastName, middleName
      // companyName
      isCompany: SC.Record.property(Boolean, { defaultValue: NO }),
      
      // contact has one or more phones stored in a hash.  
      phones: SC.Collection.inline({ recordType: 'AB.PhoneNumber' })
    });

    /* IDEA: Every record has an "owner".  The owner can be a Store or a
       Collection.  When the record is destroyed or updated, it will notify
       its owner.
       
       A Collection can be inlined, referenced, or fetched.  Inlined means 
       the full record data is stored in the parent itself.  Referenced means
       only the primaryKey is stored.  Fetched means the collection is loaded
       from the store dynamically.
       
       A Collection can also indicate that it's records are dependent.  
       Dependent records are owned exclusively by the parent record.  Deleting
       parent will delete the collection also.
       
       Otherwise deleting the record will remove it from the store only.
      */
      
    /* hm -- a record could have details stored inline for optimization, but 
       it is not actually owned there.  it should just be loaded into the 
       store and treated independently.
    */
    
    // A contact has contactDetails, which is an array of inlined contact 
    // details.
    AB.Contact = SC.Record.extend({
      
      firstNameType: String,
      lastNameType:  String,
      
      contactDetailsType: SC.Collection.inline({
        isDependent: YES,
        recordType:  'AB.ContactDetail'
      }),
      
      // a contact belongs to one or more groups stored as an array on 
      // the contact.  You can change the groups array by replacing the 
      // array.
      groups: function(key, groups) {

        // if groups is replaced, write back guids
        // also, each group record should have it's contacts invalidated.
        if (groups !== undefined) {
          this.writeAttribute('groups', groups.getEach('guid')) ;
          groups.invoke('notifyPropertyChange', 'contacts');
        }
        return this.get('store').records(this.readAttribute('groups'));
      }.property().cacheable()
      
    });
    
    AB.ContactAddress = SC.Record.extend({
      
      descriptionType: String,
      street1: String,
      street2: String,
      city: String,
      state: String,
      country: String,   
      
      // the contact the address belongs to.
      contact: function() {
        this.get('store').record(this.readAttribute('contact'));
      }
    });
    
  }
});

})();
</script>

  <script>
  SC.benchmarkPreloadEvents['bodyEnd'] = new Date().getTime();
  </script>
	</body>
</html>
